---
title: '2: Table 1 - Descriptives'
author: "Maxwell Austensen"
date: '`r Sys.Date()`'
output:
  html_notebook: default
  github_document: default
subtitle: AEM Replication
---

```{r, message=FALSE, warning=FALSE, include=FALSE}
# Install packages if needed
package_list <- c("haven", "stringr", "tidyverse", "janitor", "feather", "knitr", "rmarkdown")
new_packages <- package_list[!package_list %in% installed.packages()[,"Package"]]
if(length(new_packages)) install.packages(new_packages)

library(haven)
library(stringr)
library(tidyverse)
library(janitor)
library(feather)

# Set directories
clean_ <- "/Users/Maxwell/Box Sync/aem/replication/data/clean/"
```

```{r}
sample1 <- read_feather(str_c(clean_, "sample1.feather")) %>% mutate(sample = "Sample 1")
sample2 <- read_feather(str_c(clean_, "sample2.feather")) %>% mutate(sample = "Sample 2")
sample3 <- read_feather(str_c(clean_, "sample3.feather")) %>% mutate(sample = "Sample 3")
```

```{r}
format_sd <- function(x, digits = 2) {
  x %>% round(digits = digits) %>% str_c("(", ., ")")
}

format_mean <- function(val, digits = 2) {
  val %>% round(digits = digits) %>% as.character()
}
```

```{r, message=FALSE, warning=FALSE}

order_vec <- c("marriage_ended_mean", "marriage_ended_sd", "age_married_mean", "age_married_sd", "firstborn_girl_mean", 
               "firstborn_girl_sd", "n_children_mean", "n_children_sd", "age_birth_mean", "age_birth_sd", "age_mean", 
               "age_sd", "educ_yrs_mean", "educ_yrs_sd", "urban_mean", "urban_sd", "hhincome_std_mean", 
               "hhincome_std_sd", "poverty_status_mean", "poverty_status_sd", "nonwoman_inc_mean", 
               "nonwoman_inc_sd", "woman_inc_mean", "woman_inc_sd", "woman_earn_mean", "woman_earn_sd", 
               "observations_mean", "observations_sd")

bind_rows(sample1, sample2, sample3) %>% 
  group_by(sample) %>% 
  mutate(observations = n()) %>% 
  select(marriage_ended, age_married, firstborn_girl, n_children, age_birth, age, educ_yrs, urban, 
         hhincome_std, poverty_status, nonwoman_inc, woman_inc, woman_earn, observations) %>% 
  summarise_all(funs(mean, sd)) %>%
  mutate_at(vars(contains("_mean")), format_mean) %>%
  mutate_at(vars(contains("_sd")), format_sd) %>%
  gather("variable", "value", -sample) %>% 
  spread(sample, value) %>% 
  mutate(variable = ordered(variable, levels = order_vec)) %>% 
  arrange(variable) %>% 
  filter(variable != "observations_sd") %>% 
  mutate(variable = str_replace(variable, "_mean", ""),
         variable = if_else(str_detect(variable, "_sd"), "", variable)) %>% 
  knitr::kable()
```

